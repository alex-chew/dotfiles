#!/usr/bin/env bash

info=$(nmcli -f "GENERAL.STATE,GENERAL.CONNECTION" dev show wlan0)

source $(dirname $0)/_colors

if [[ $(echo $info | awk '{ print $3 }') != '(connected)' ]]; then
  # full text
  echo "   down"
  # short text
  echo
  #color
  echo ${base03}

else
  ssid=$(echo $info | awk '{ print $5 }')
  ip=$(ip addr show wlan0 | awk '/inet / { print $2 }' | cut -d \/ -f 1)
  qual=$(grep wlan0 /proc/net/wireless | awk '{ print int($3 * 100 / 70) }')

  # full text
  echo "   $ip on $ssid ($qual%)"
  
  # short text
  echo

  # color
  if (( "$qual" > 70 )); then
    echo ${base07}
  elif (( "$qual" > 40 )); then
    echo ${base0A}
  elif (( "$qual" > 20 )); then
    echo ${base09}
  else
    echo ${base08}
  fi

fi

