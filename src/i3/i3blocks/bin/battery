#!/usr/bin/env bash

path=$(upower -e | grep 'battery_')
if [[ -z "$path" ]]; then
  exit 3 # no battery
fi

info=$(upower -i "$path")
perc=$(echo "$info" | awk '/percentage:/ { print $2 }' | sed 's/%//')
time=$(echo "$info" | awk '/time to (empty|full):/ { printf "%.1s %.0f%.1s", $3, $4, $5 }' | sed 'y/ef/↓↑/')

# full text
if [[ -n "$time" ]]; then
  echo "${perc} $time"
else
  echo "${perc}"
fi

# short text
echo

# color
if (( $(echo "$perc > 50" | bc -l) )); then
  echo "{{ i3.fg }}"
elif (( $(echo "$perc > 20" | bc -l) )); then
  echo "{{ i3.warning }}"
else
  echo "{{ i3.urgent }}"
fi


